<!DOCTYPE HTML>
<html lang="en">
<meta charset="utf-8">
	<head>
	<title>Rainbow Forest</title>
	<style type="text/css">
		body {
			background-color:black;
			margin:0px;
			overflow : hidden;
		}
		</style>
	</head>

	<body>

		<script>

var canvas = document.createElement('canvas');
document.body.appendChild(canvas);
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

var ctx = canvas.getContext('2d');
var generation = 0;
var size_o = 100;
var size_m = 27;
var deg = 35;
var trees = 1;
var forest=[];
for (var i=0; i<trees; i++) forest.push(new Branch(size_o,0));

draw();

function draw() {
	ctx.save();
	ctx.clearRect(0,0,canvas.width, canvas.height);
	ctx.translate(0, canvas.height);
	for(var i = 0; i<trees; i++) {
		ctx.translate(canvas.width/(trees+1), 0);
		forest[i].render('rgb(255,255,255)');
	}
	ctx.restore();

	window.requestAnimationFrame(draw);
}

function Leaf(size) {
	generation++;
	var growth = 0;
	var delay = generation*10;
	//var lum = Math.pow((parseFloat(size)/parseFloat(size_o)),1/4)*100.0;
	//var lum = (parseFloat(size)/parseFloat(size_o))*100.0;
	var lum = 60;
	var hue = random(0,360);
	var _col = 'hsl('+hue+',100%,' + 60 + '%)';

	this.render = function(col) {
		ctx.save();
		var radius = size*growth*0.5;
		var grad = ctx.createLinearGradient(0, 0, 0, -size*growth);
		grad.addColorStop(1,String(_col));
		grad.addColorStop(0,String(col));
		ctx.fillStyle = grad;
		hue+=random(0.5,2);
		_col = 'hsl('+hue+',100%,' + lum + '%)';
   	ctx.translate(0,5);
		ctx.beginPath();
		ctx.moveTo(0, 0);
		//cx, cy,  ex, ey
		ctx.quadraticCurveTo(size*growth*2/5, -size*growth/6, 0, -size*growth*2/3);
		ctx.quadraticCurveTo(-size*growth*2/5, -size*growth/6, 0, 0);
		ctx.fill();
		ctx.restore();
		if(delay>0) delay--;
		else growth+=(1-growth) * 0.1;
	}
	generation--;
}

function Branch(size, rotation) {
	generation++;
	var sway = 0;
	var swaySpeed = random(0.02,0.1);
	var growth = 0;
	var delay = generation*10;
	//var lum = Math.pow((parseFloat(size)/parseFloat(size_o)),3/4)*100.0;
	var lum = (parseFloat(size)/parseFloat(size_o))*100.0;
	var hue = random(0,360);
	var _col = 'hsl('+hue+',100%,' + lum + '%)';

	this.children = [];
	if(size>size_m) {
		this.children.push(new Branch(size*random(0.7,0.9), random(0,deg)));
		this.children.push(new Branch(size*random(0.7,0.9), random(0,-deg)));
	}
	//else if (random(0,2)<1) this.children.push(new Leaf(size*random(0.7,0.9)));
	else this.children.push(new Leaf(size*random(0.7,0.9)));

	this.render = function(col) {
		ctx.save();
		ctx.rotate((rotation+Math.sin(sway)) * Math.PI/180);

		var grad = ctx.createLinearGradient(0, 0, 0, -size*growth);
		grad.addColorStop(1,String(_col));
		grad.addColorStop(0,String(col));
		ctx.strokeStyle = grad;
		hue+=random(0.5,2);
		_col = 'hsl('+hue+',100%,' + lum + '%)';
		ctx.beginPath();
		ctx.lineWidth = size*0.1*growth;
		ctx.moveTo(0,0);
		ctx.lineTo(0,-size*growth);
		ctx.stroke();
		ctx.translate(0,-size*growth);

		for(var i = 0; i<this.children.length; i++) this.children[i].render(_col);

		ctx.restore();
		sway+=swaySpeed;
		if(delay>0) delay--;
		else growth+=(1-growth) * 0.1;
	}
	generation--;
}

function random(min, max) { return Math.random()*(max-min) +min; }


</script>
</body>
</html>
